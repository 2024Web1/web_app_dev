# ミニショップ2

- [ミニショップ2](#ミニショップ2)
  - [事前準備](#事前準備)
  - [商品詳細画面の作成](#商品詳細画面の作成)
    - [Product.classの修正](#productclassの修正)
    - [詳細表示画面（product\_detail.php）](#詳細表示画面product_detailphp)
    - [ジャンル別商品一覧画面（product\_select.php）の修正](#ジャンル別商品一覧画面product_selectphpの修正)
  - [動作確認](#動作確認)
  - [課題の提出と採点について](#課題の提出と採点について)
    - [課題の合格基準](#課題の合格基準)
    - [合格確認方法](#合格確認方法)
    - [エラーが出た時の対処法](#エラーが出た時の対処法)
    - [タイムアウトになっていないかを確認する](#タイムアウトになっていないかを確認する)
    - [プログラムが正確に書かれているか確認する](#プログラムが正確に書かれているか確認する)
      - [どこでエラーがでているか確認する](#どこでエラーがでているか確認する)
      - [プログラムが正確に書かれているか確認する](#プログラムが正確に書かれているか確認する-1)
  - [GitHub上での採点についてのお願い](#github上での採点についてのお願い)

## 事前準備

前回の「13.ミニショップ1」でcloneしたコードをそのまま利用する。

## 商品詳細画面の作成

ジャンル別商品一覧画面（product_select.php）の「詳細」リンクをクリックすると、選択された商品の商品詳細画面（product_detail.php）が表示される。

ジャンル別商品一覧画面 ：**product\_select.php**</br>

<img src="./images/13/product_select_display_linkclick.png" width="70%">

商品詳細画面：**product\_detail.php**</br>
![](./images/13/product_detail_display.png)

ここでは、商品詳細画面の「product_detail.php」の作成だけでなく、商品データを操作する「Product.class」の修正も行う。

### Product.classの修正

商品詳細画面を表示するための処理の流れは次の通り。

1. 送られてきた商品番号を受け取る。
1. 受け取った商品番号のデータをテーブルitemsから抽出する。
1. 抽出した商品データの結果セット（データは1件だけ）を受け取る。
1. 商品データの結果セットから詳細画面を作成する。

このうち、「2」と「3」の処理を 「Product.class」 に実装し、「product_detail.php」 からは 「Product.class」 のオブジェクトを生成し、受け取った商品番号のデータを抽出するメソッドを呼び出して、商品データの結果セットを受け取る。

そこでまず、「Product.class」 に次の条件でメソッドを追加定義する。

```text
アクセス修飾子： public
メソッド名： getItem
引数： $ident （選択された商品番号）
戻り値： 抽出した商品データの結果セット（データは1件だけ）
```

具体的には、`getItem` メソッドを「product.php」に追加する。</br>
**product.php**

![](./images/13/product2_code.png)

### 詳細表示画面（product_detail.php）

この画面の完成形は次の通り。（ジャンル＝ブック、商品番号=6が選ばれた場合）

<img src="./images/13/product_detail_display.png" width="70%">

プルダウンメニューを開いた状態</br>
![](./images/13/product_detail_pulldown_display.png)

完成形の画面を参考に、次の 「product_detail.php」 の **①から⑩** に適切なコード記述し完成させよ。

<div style="page-break-before:always"></div>

**product\_detail.php**

<img src="./images/13/product_detail_ana_code.png" width="97%">

＊⑨では商品の価格を表示している。「3621」を「¥3,621」と表示させる方法は「product_select.php」で使用しているので参考のこと。

**注文数のプルダウンメニューを表示するコードについて**

```php
<select name="quantity">
<?php
	for ($i = 1; $i <= 10; $i++) {
		echo '<option value="' . $i . '">' . $i . '</option>';
	}
?>
</select>
```

注文数は「1 ～ 10」のプルダウンメニューで表示するが、この `<option></option>` タグをこのように `for` 文を使って書くことがよく使われる。

この先で作成する「カート内の商品（cart_list.php）では、この書き方を応用して カート内の商品の注文数を表示している。

![](./images/13/cart_list_display_pulldown.png)

### ジャンル別商品一覧画面（product_select.php）の修正

以上で商品詳細画面（product_detail.php）が完成するが、ひとつ問題が発生する。</br>
それは、商品詳細画面（product_detail.php）の「ジャンル選択に戻る」リンクをクリックすると次のエラー画面となる。※Macでのエラー画面なのでエラーメッセージはWindowsと微妙に違うが意味はほぼ同じである。

![](./images/13/product_select_display_error.png)

このエラーは「ジャンル別商品一覧（product_select.php）」のプログラムで発生しているので、正しく「ジャンル別商品一覧」画面が表示されるように「**product\_select.php**」を修正せよ。

**【ヒント】**

**$\_SERVER["REQUEST\_METHOD"] を用いる。 これが何をするもので、どう使うかは各自で調べよう。**

<div style="page-break-before:always"></div>

## 動作確認

以上の作業終了後、次のように画面が表示されることを確認する。

1. ジャンル＝パソコンの最初の商品（商品番号=1）を選択した場合</br>
   ジャンル別商品一覧画面と商品詳細画面が行き来できること

<img src="./images/13/product_select_display_pc_kakunin.png" width="80%"></br>
`　　　　　　　　　　　　　　　　　　　　`↕️
<img src="./images/13/product_detail_display_pc_kakunin.png" width="80%">

<div style="page-break-before:always"></div>

1. ジャンル＝ブックの最初の商品（商品番号=6）が選択された場合

<img src="./images/13/product_select_display_book_kakunin.png" width="80%"></br>
`　　　　　　　　　　　　　　　　　　　　`↕️
<img src="./images/13/product_detail_display_book_kakunin.png" width="80%">

<div style="page-break-before:always"></div>

1. ジャンル＝ミュージックの最初の商品（商品番号=11）が選択された場合

<img src="./images/13/product_select_display_music_kakunin.png" width="80%"></br>
`　　　　　　　　　　　　　　　　　　　　`↕️
<img src="./images/13/product_detail_display_music_kakunin.png" width="80%">

## 課題の提出と採点について

pushで提出した課題は、GitHub上で自動採点される。提出後、課題が合格しているかを確認すること。合格していない場合は修正後pushし、再提出すること。

### 課題の合格基準

以下を合格基準とする。

1. ジャンル別商品一覧画面で、選択したジャンルの商品一覧が表示されること
2. 商品詳細画面で、ジャンル別商品一覧画面で選択した商品の詳細が表示されること

<div style="page-break-before:always"></div>

### 合格確認方法

1. 本課題の[課題ページ](https://classroom.github.com/a/4ZOKphQa)に再度アクセスする。
2. 画面上部にある`Actions`をクリックする。</br>
![](./images/13/acions.png)
1. **一番上**の行に、緑色のチェックが入っていればOK。※その下に赤いばつ印が入っているものがあるが、それは無視する。</br>
![](./images/13/pass.png)

### エラーが出た時の対処法

自動採点がエラーになると、**一番上**の行に赤いばつ印がでる。その場合の解決策を以下に示す。

### タイムアウトになっていないかを確認する

※右端の赤枠で囲まれている箇所に処理時間がでるが、**2分以上**かかっている場合はタイムアウトとなる。
![](./images/13/timeout.png)

なお、タイムアウトの場合は、GitHub上で処理を再開すると解決できる。具体的なタイムアウト解決方法は、

  1. Actionsタブをクリック
  2. タイトルが下記のようにリンクになっているので、クリック</br>
      ![](./images/13/timeout2.png)</br>
  3. Autogradingをクリック</br>
   <img src="./images/13/timeout3.png" width="75%"></br>
   <div style="page-break-before:always"></div>

  4. 赤いばつ印が出ている箇所をクリック</br>
   <img src="./images/13/timeout4.png" width="75%"></br>
  1. `::error::Setup timed out in 120000 milliseconds`のメッセージがあればタイムアウト

  6. 右上に`Re-run jobs`(再実行)のボタンがあるので、`Re-run failed jobs`(失敗した処理だけ再実行)をクリックする。
  ![](./images/13/timeout6.png)</br>
  ![](./images/13/timeout7.png)
  7. タイムアウトにならず2分以内に処理が終了したらOK。※タイムアウトでないエラーは、次の解決策を参照。

<div style="page-break-before:always"></div>

### プログラムが正確に書かれているか確認する

プログラムが正確に書かれているかを確認すること。たとえ、ブラウザの画面でそれっぽく表示されても、自動採点なので融通がきかない。エラーが出た際は、以下を確認すること。

#### どこでエラーがでているか確認する

今回は2つの自動採点(新規ユーザー登録処理、ログイン認証処理)があるので、以下の手順で、どごでエラーが出ているか確認する。

1. Actionsタブをクリック
2. タイトルが下記のようにリンクになっているので、クリック
      ![](./images/13/timeout2.png)</br>
3. Autogradingをクリック</br>
   <img src="./images/13/timeout3.png" width="65%"></br>
4. 赤いばつ印が出ている箇所をクリック</br>
  <img src="./images/13/timeout4.png" width="65%"></br>
1. エラーがあるソースコードは、下記画像のように、エラーメッセージが表示されるので、これにエラーが出ているソースコードを特定できる。</br>
<img src="./images/13/error_message.png" width="75%"></br>

#### プログラムが正確に書かれているか確認する

プログラムが正確に書かれているかを確認する。たとえ、ブラウザの画面でそれっぽく表示されても、自動採点ですので融通はききません。エラーが出た際は、サンプルコードと差異がないか確認してください。

<div style="page-break-before:always"></div>

## GitHub上での採点についてのお願い

今回、再度GitHub上での採点をするにあたりお願いがあります。それは、</br>
GitHubに課題をpushする前に、**必ずブラウザで動作確認をしてください。**　理由は下記の2つです。</br>

1. Webアプリケーションはブラウザ上で動作することが前提であるため。
2. GitHubの採点処理時間に上限があるため。</br>
以前の自動採点プログラムと比べ、処理時間の高速化には成功したものの、GitHubの合計処理時間には毎月上限があります。むやみやたらにpushすると、上限に達しかねないので、必ずブラウザ上で正常に動作することを確認してからpushしてください。**エラーの原因が特定できない場合は、お気軽に質問してください。**
