# ミニショップ5

- [ミニショップ5](#ミニショップ5)
  - [注文数を変更する](#注文数を変更する)
    - [カート内の商品（cart\_list.php）の修正](#カート内の商品cart_listphpの修正)
    - [注文数変更（cart\_change.php）の作成](#注文数変更cart_changephpの作成)
    - [Cartクラス（cart.php）の修正](#cartクラスcartphpの修正)
    - [動作確認](#動作確認)
  - [課題の提出と採点について](#課題の提出と採点について)
    - [課題の合格基準](#課題の合格基準)
    - [合格確認方法](#合格確認方法)
    - [エラーが出た時の対処法](#エラーが出た時の対処法)
    - [タイムアウトになっていないかを確認する](#タイムアウトになっていないかを確認する)
    - [プログラムが正確に書かれているか確認する](#プログラムが正確に書かれているか確認する)
      - [どこでエラーがでているか確認する](#どこでエラーがでているか確認する)
      - [プログラムが正確に書かれているか確認する](#プログラムが正確に書かれているか確認する-1)
  - [GitHub上での採点についてのお願い](#github上での採点についてのお願い)

## 注文数を変更する

この機能は次のファイルの修正・作成により実装する。

### カート内の商品（cart_list.php）の修正

1. テーブルcartに登録されている注文数を最大値「10」までのプルダウンメニューを使用し、現在の注文数を表示する。
2. 「変更」ボタンを追加し、クリックすると「注文数変更」（cart_change.php）に商品番号と変更後の注文数を送信する。

### 注文数変更（cart_change.php）の作成

1. カート内の商品（cart_list.php）から送られてきた「商品番号」と「注文数」を受け取る。
2. Cartクラスのオブジェクトを生成し、受け取った「商品番号」と「注文数」を引数に「注文数変更メソッド」を呼び出す。
3. カート内の商品（cart_list.php）を読み込む。

＊14.ミニショップ3の「注文追加」（cart_add.php）のコードを参考に作成する。

### Cartクラス（cart.php）の修正

引数として受け取った「商品番号」をキーにテーブルcartの該当商品の「注文数」を変更する「注文数変更メソッド」を次の仕様で定義する。

```text
アクセス修飾子： public
メソッド名： changeQuantity
引数： $ident（商品番号）、$quanity（注文数）
戻り値： なし
```

<div style="page-break-before:always"></div>

### 動作確認

1. 注文数「1」で商品がカートに入っている

![](./images/14/cart_change_display_1.png)

2. この商品の注文数を「3」に変更する

![](./images/14/cart_change_display_2.png)

<div style="page-break-before:always"></div>

3. 金額・合計金額が更新される。「変更」ボタンをクリックすると

![](./images/14/cart_change_display_3.png)

## 課題の提出と採点について

pushで提出した課題は、GitHub上で自動採点される。提出後、課題が合格しているかを確認すること。合格していない場合は修正後pushし、再提出すること。

### 課題の合格基準

以下を合格基準とする。

1. カートへの追加機能が実装されていること
2. カートの特定商品の注文数を変更する機能が実装されていること
3. カートの特定商品の削除機能が実装されていること

<div style="page-break-before:always"></div>

### 合格確認方法

1. 本課題の[課題ページ](https://classroom.github.com/a/VVo3y7HS)に再度アクセスする。
2. 画面上部にある`Actions`をクリックする。</br>
![](./images/13/acions.png)
1. **一番上**の行に、緑色のチェックが入っていればOK。※その下に赤いばつ印が入っているものがあるが、それは無視する。</br>
![](./images/13/pass.png)

### エラーが出た時の対処法

自動採点がエラーになると、**一番上**の行に赤いばつ印がでる。その場合の解決策を以下に示す。

### タイムアウトになっていないかを確認する

※右端の赤枠で囲まれている箇所に処理時間がでるが、**2分以上**かかっている場合はタイムアウトとなる。
![](./images/13/timeout.png)

なお、タイムアウトの場合は、GitHub上で処理を再開すると解決できる。具体的なタイムアウト解決方法は、

  1. Actionsタブをクリック
  2. タイトルが下記のようにリンクになっているので、クリック</br>
      ![](./images/13/timeout2.png)</br>
  3. Autogradingをクリック</br>
   <img src="./images/14/timeout3.png" width="75%"></br>
   <div style="page-break-before:always"></div>

  4. 赤いばつ印が出ている箇所をクリック</br>
   <img src="./images/14/timeout4.png" width="75%"></br>
  1. `::error::Setup timed out in 120000 milliseconds`のメッセージがあればタイムアウト

  6. 右上に`Re-run jobs`(再実行)のボタンがあるので、`Re-run failed jobs`(失敗した処理だけ再実行)をクリックする。
  ![](./images/13/timeout6.png)</br>
  ![](./images/13/timeout7.png)
  7. タイムアウトにならず2分以内に処理が終了したらOK。※タイムアウトでないエラーは、次の解決策を参照。

<div style="page-break-before:always"></div>

### プログラムが正確に書かれているか確認する

プログラムが正確に書かれているかを確認すること。たとえ、ブラウザの画面でそれっぽく表示されても、自動採点なので融通がきかない。エラーが出た際は、以下を確認すること。

#### どこでエラーがでているか確認する

今回は2つの自動採点(新規ユーザー登録処理、ログイン認証処理)があるので、以下の手順で、どごでエラーが出ているか確認する。

1. Actionsタブをクリック
2. タイトルが下記のようにリンクになっているので、クリック
      ![](./images/14/timeout2.png)</br>
3. Autogradingをクリック</br>
   <img src="./images/14/timeout3.png" width="65%"></br>
4. 赤いばつ印が出ている箇所をクリック</br>
  <img src="./images/14/timeout4.png" width="65%"></br>
1. エラーがあるソースコードは、エラーメッセージが表示されるので、エラー箇所の参考にすること。</br>

#### プログラムが正確に書かれているか確認する

プログラムが正確に書かれているかを確認する。たとえ、ブラウザの画面でそれっぽく表示されても、自動採点ですので融通はききません。エラーが出た際は、サンプルコードと差異がないか確認してください。

<div style="page-break-before:always"></div>

## GitHub上での採点についてのお願い

今回、再度GitHub上での採点をするにあたりお願いがあります。それは、</br>
GitHubに課題をpushする前に、**必ずブラウザで動作確認をしてください。**　理由は下記の2つです。</br>

1. Webアプリケーションはブラウザ上で動作することが前提であるため。
2. GitHubの採点処理時間に上限があるため。</br>
以前の自動採点プログラムと比べ、処理時間の高速化には成功したものの、GitHubの合計処理時間には毎月上限があります。むやみやたらにpushすると、上限に達しかねないので、必ずブラウザ上で正常に動作することを確認してからpushしてください。**エラーの原因が特定できない場合は、お気軽に質問してください。**
